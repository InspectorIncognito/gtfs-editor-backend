services:
  nginx:
    build:
      context: ..
      dockerfile: docker/nginx/Dockerfile
      target: certbot
    profiles: [ 'certbot' ]
    expose:
      - 80
    ports:
      - "80:80"
  web:
    profiles: [ 'certbot' ]
  cache:
    profiles: [ 'certbot' ]
  db:
    profiles: [ 'certbot' ]
  certbot:
    profiles: ['certbot']
    image: certbot/certbot
    container_name: certbot
    volumes:
      - certbot-etc:/etc/letsencrypt
      - certbot-var:/var/lib/letsencrypt
      - static_volume:/app/backend/static
      - web-root:/var/www/html
    depends_on:
      - nginx
    command: certonly --webroot --webroot-path=/var/www/html --email dgarcia@transapp.cl --agree-tos --no-eff-email -d gtfseditor.transapp.cl -d www.gtfseditor.transapp.cl -d gtfs-editor.transapp.cl -d www.gtfs-editor.transapp.cl --force-renewal